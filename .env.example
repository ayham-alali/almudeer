# Al-Mudeer Backend Environment Variables
# Copy this file to .env and fill in the values

# ============ Required ============

# Admin key for protected endpoints (generate a strong random string)
ADMIN_KEY=your-secure-admin-key-here

# Encryption key for sensitive data (32+ characters recommended)
ENCRYPTION_KEY=your-encryption-key-here

# ============ Database ============

# Database type: "sqlite" (development) or "postgresql" (production)
# IMPORTANT: Use postgresql for production with 100+ users
DB_TYPE=sqlite

# SQLite database path (when DB_TYPE=sqlite)
DATABASE_PATH=almudeer.db

# PostgreSQL connection URL (when DB_TYPE=postgresql)
# Railway auto-populates this variable when you add PostgreSQL add-on
# DATABASE_URL=postgresql://user:password@host:5432/dbname

# ============ AI / LLM (Vertex AI Production Setup) ============

# Provider 1: Google Gemini via Vertex AI (PRIMARY)
# Uses service account authentication for better quotas
# Get credentials: Google Cloud Console → IAM & Admin → Service Accounts

# GCP Project and Location for Vertex AI
GCP_PROJECT_ID=your-gcp-project-id
GCP_LOCATION=us-central1

# Service account credentials file path (local development)
# Point to your downloaded service account JSON file
GOOGLE_APPLICATION_CREDENTIALS=service_account.json

# Service account JSON content (Railway/production deployment)
# Paste the entire JSON content as a single line (Railway handles newlines)
# GCP_SERVICE_ACCOUNT_KEY={"type":"service_account","project_id":"..."}

# Gemini model to use
GOOGLE_MODEL=gemini-2.5-flash

# Legacy API key (deprecated, kept for fallback to AI Studio)
# GOOGLE_API_KEY=your_gemini_key_here

# Provider 2: OpenRouter (BACKUP - Free models)
# Get free key: https://openrouter.ai (sign up with GitHub)
OPENROUTER_API_KEY=your_openrouter_key_here
OPENROUTER_MODEL=google/gemini-2.0-flash-exp:free

# Failover chain: Gemini (Vertex AI) → OpenRouter → Rule-based (offline)

# LLM Caching (CRITICAL - reduces API calls by 60-80%)
LLM_CACHE_ENABLED=true
LLM_CACHE_TTL_HOURS=48

# Concurrency control (prevents rate limiting)
# Vertex AI has better quotas, but keep conservative for safety
LLM_MAX_CONCURRENT=2

# Delay between requests in seconds (rate limit protection)
LLM_REQUEST_DELAY=2.0

# ============ Gmail OAuth 2.0 ============

# Get these from Google Cloud Console: https://console.cloud.google.com/
# GMAIL_CLIENT_ID=your-client-id.apps.googleusercontent.com
# GMAIL_CLIENT_SECRET=your-client-secret
# GMAIL_REDIRECT_URI=https://your-domain.com/api/integrations/email/oauth/callback

# ============ Telegram ============

# Get these from https://my.telegram.org/apps
# TELEGRAM_API_ID=12345678
# TELEGRAM_API_HASH=your-api-hash

# ============ WhatsApp Business ============

# Get these from Meta for Developers: https://developers.facebook.com/
# WHATSAPP_PHONE_NUMBER_ID=your-phone-number-id
# WHATSAPP_ACCESS_TOKEN=your-access-token
# WHATSAPP_VERIFY_TOKEN=your-verify-token

# ============ Redis Caching (Recommended for 50+ users) ============
# Railway auto-populates this when you add Redis add-on
# REDIS_URL=redis://default:password@host:6379

# ============ Frontend URL ============

# Used for CORS and OAuth redirects
FRONTEND_URL=https://almudeer.royaraqamia.com

# ============ JWT Authentication ============
# Secret key for token signing (auto-generated if not set)
# JWT_SECRET_KEY=your-secure-secret-key-min-32-chars

JWT_ACCESS_EXPIRE_MINUTES=30
JWT_REFRESH_EXPIRE_DAYS=7

# ============ Database Query Timeout ============
DB_QUERY_TIMEOUT=30

# ============ Auto Update Configuration ============

# Maximum APK file size in MB (prevent DoS attacks)
# Default: 150MB - accommodates future app growth
MAX_APK_SIZE_MB=150

# APK CDN URL (REQUIRED - Your Cloudflare R2 or custom CDN URL)
# For split APKs, users will be auto-redirected to the correct variant
# NOTE: This points to Railway's /apk endpoint which detects device architecture
# and redirects to the appropriate R2 URL. Do NOT use R2 custom domain here.
APK_CDN_URL=https://almudeer.up.railway.app/apk

# Architecture-specific APK CDN URLs (RECOMMENDED - for split APKs)
# 1. Build: flutter build apk --split-per-abi
# 2. Upload each to Cloudflare R2
# 3. Paste the public URLs here (direct R2 URLs):
APK_CDN_URL_ARM64=https://your-domain.com/almudeer_arm64_v8a.apk
APK_CDN_URL_ARMV7=https://your-domain.com/almudeer_armeabi_v7a.apk
APK_CDN_URL_X86=https://your-domain.com/almudeer_x86_64.apk

# Fallback URL if CDN fails (points to backend's static/download/ endpoint)
APP_DOWNLOAD_URL=https://almudeer.up.railway.app/download/download/almudeer.apk

# Force update system toggle
# Set to false to temporarily disable all force updates (emergency only)
FORCE_UPDATE_ENABLED=true

# Rate limiting for version check endpoint (prevent abuse)
# 60 requests per minute per device/IP
RATE_LIMIT_REQUESTS=60
RATE_LIMIT_WINDOW=60

# iOS App Store configuration (OPTIONAL - only if you have iOS app)
# IOS_STORE_URL=https://apps.apple.com/app/id123456789
# IOS_APP_STORE_ID=id123456789

# Admin IP whitelist (OPTIONAL - comma-separated IPs for extra security)
# Leave empty to allow admin access from any IP (protected by ADMIN_KEY only)
ADMIN_IP_WHITELIST=

# HTTPS enforcement (OPTIONAL - set to true in production)
HTTPS_ONLY=true
